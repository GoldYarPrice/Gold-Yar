<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FFD700">
    <title>Ø·Ù„Ø§ ÛŒØ§Ø± - Ù…ÛŒÙ†ÛŒ Ø§Ù¾</title>
    <script src="https://web.telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* ğŸ¨ Ø·Ù„Ø§ ÛŒØ§Ø± - Mini App Styles */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        :root {
            /* Light Theme */
            --primary-color: #FFD700;
            --primary-dark: #FFC700;
            --secondary-color: #4F46E5;
            --danger-color: #EF4444;
            --success-color: #10B981;
            --warning-color: #F59E0B;

            --bg-color: #FFFFFF;
            --bg-secondary: #F9FAFB;
            --bg-tertiary: #F3F4F6;

            --text-color: #1F2937;
            --text-secondary: #6B7280;
            --text-tertiary: #9CA3AF;

            --border-color: #E5E7EB;
            --border-light: #F3F4F6;

            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;

            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        html[data-theme="dark"] {
            --bg-color: #111827;
            --bg-secondary: #1F2937;
            --bg-tertiary: #374151;
            --text-color: #F9FAFB;
            --text-secondary: #D1D5DB;
            --text-tertiary: #9CA3AF;
            --border-color: #374151;
            --border-light: #1F2937;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            font-size: 16px;
            overflow-x: hidden;
        }

        /* Navigation */
        .nav-tabs {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 8px 0;
            z-index: 100;
        }

        .nav-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
            font-size: 12px;
            min-width: 60px;
        }

        .nav-tab .icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .nav-tab .label {
            font-size: 10px;
        }

        .nav-tab.active {
            color: var(--primary-color);
        }

        /* Main Container */
        .main-container {
            padding-bottom: 80px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 16px;
        }

        .section {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 28px;
            margin: 0;
        }

        .theme-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background-color: var(--bg-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* Price Cards */
        .prices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
        }

        .price-card {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 16px;
            text-align: center;
        }

        .price-card-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .price-card-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .price-card-change {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
        }

        .price-card-change.positive {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--success-color);
        }

        .price-card-change.negative {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
        }

        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: #000;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-block {
            width: 100%;
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .quick-actions .btn {
            width: 100%;
        }

        /* Lists */
        .portfolio-list,
        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .portfolio-item,
        .alert-item {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .portfolio-item-info,
        .alert-item-info {
            flex: 1;
        }

        .portfolio-item-title,
        .alert-item-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .portfolio-item-details,
        .alert-item-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border: none;
            background-color: var(--bg-tertiary);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 16px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 200;
        }

        .modal.active {
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--bg-color);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            max-width: 600px;
            width: 100%;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background-color: var(--bg-secondary);
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            padding: 20px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background-color: var(--bg-secondary);
            color: var(--text-color);
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: var(--text-color);
            padding: 16px 20px;
            border-radius: var(--radius-md);
            display: none;
            z-index: 300;
            max-width: 90%;
        }

        .toast.show {
            display: block;
        }

        /* Skeleton */
        .skeleton-loading {
            background: linear-gradient(90deg, var(--bg-tertiary) 0%, var(--border-color) 50%, var(--bg-tertiary) 100%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            height: 100px;
            border-radius: var(--radius-md);
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* Profile */
        .profile-header {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            padding: 20px;
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .profile-info {
            flex: 1;
        }

        .profile-info h2 {
            margin: 0;
            font-size: 20px;
        }

        .profile-info p {
            margin: 4px 0 0 0;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .profile-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .profile-detail-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background-color: var(--bg-secondary);
            border-radius: var(--radius-md);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background-color: var(--bg-secondary);
            border-radius: var(--radius-md);
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: var(--transition);
        }

        input:checked+.toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked+.toggle-slider:before {
            transform: translateX(20px);
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .stat-card:nth-child(3) {
                grid-column: 1 / -1;
            }
        }

        /* Auth Page */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 1000;
        }

        .auth-content {
            width: 100%;
            max-width: 400px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .auth-header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            color: var(--primary-color);
        }

        .auth-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .auth-step h2 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .auth-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 20px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .link-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            text-decoration: underline;
            padding: 0;
            font-size: inherit;
        }

        .link-btn:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <!-- Navigation Tab Bar -->
    <nav class="nav-tabs" id="nav-tabs" style="display: none;">
        <button class="nav-tab active" data-tab="home">
            <span class="icon">ğŸ </span><span class="label">Ø®Ø§Ù†Ù‡</span>
        </button>
        <button class="nav-tab" data-tab="portfolio">
            <span class="icon">ğŸ’</span><span class="label">Ø¯Ø§Ø±Ø§ÛŒÛŒ</span>
        </button>
        <button class="nav-tab" data-tab="prices">
            <span class="icon">ğŸ“Š</span><span class="label">Ù‚ÛŒÙ…Øª</span>
        </button>
        <button class="nav-tab" data-tab="alerts">
            <span class="icon">ğŸ””</span><span class="label">Ù‡Ø´Ø¯Ø§Ø±</span>
        </button>
        <button class="nav-tab" data-tab="profile">
            <span class="icon">ğŸ‘¤</span><span class="label">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
        </button>
    </nav>

    <!-- Login Page -->
    <div id="login-page" class="auth-container" style="display: flex;">
        <div class="auth-content">
            <div class="auth-header">
                <h1>ğŸ’° Ø·Ù„Ø§ ÛŒØ§Ø±</h1>
                <p>Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø·Ù„Ø§</p>
            </div>

            <div id="login-step" class="auth-step">
                <h2>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨</h2>
                <p class="auth-description">Ø´Ù†Ø§Ø³Ù‡ Ø¹Ø¯Ø¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>

                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label>Ø´Ù†Ø§Ø³Ù‡ Ø¹Ø¯Ø¯ÛŒ Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                        <input type="number" id="user-id-input" placeholder="Ù…Ø«Ø§Ù„: 7603976062" required
                            autocomplete="off">
                        <small id="user-id-hint" style="color: var(--text-secondary); margin-top: 8px; display: none;">
                            Ø´Ù†Ø§Ø³Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ <button type="button" class="link-btn" id="show-get-id-btn">Ø¯Ø±ÛŒØ§ÙØª
                                Ø´Ù†Ø§Ø³Ù‡</button>
                        </small>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">ÙˆØ±ÙˆØ¯</button>
                </form>

                <div id="get-id-section"
                    style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <h3>Ø¯Ø±ÛŒØ§ÙØª Ø´Ù†Ø§Ø³Ù‡ Ø¹Ø¯Ø¯ÛŒ</h3>
                    <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 12px;">
                        Ø§Ø¨ØªØ¯Ø§ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¨Ù‡ Ø±Ø¨Ø§Øª Ø·Ù„Ø§ ÛŒØ§Ø± Ø¨Ø±ÙˆÛŒÛŒØ¯
                    </p>
                    <button type="button" class="btn btn-secondary btn-block" id="open-bot-btn">
                        ğŸ¤– Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø±Ø¨Ø§Øª
                    </button>
                    <p style="color: var(--text-secondary); font-size: 13px; margin-top: 12px;">
                        Ø³Ù¾Ø³ Ø¯Ø³ØªÙˆØ± Ø²ÛŒØ± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:
                    </p>
                    <div
                        style="background-color: var(--bg-secondary); padding: 12px; border-radius: 8px; margin-top: 8px; font-family: monospace;">
                        /whatismyid
                    </div>
                    <p style="color: var(--text-secondary); font-size: 13px; margin-top: 12px;">
                        Ø±Ø¨Ø§Øª Ø´Ù†Ø§Ø³Ù‡ Ø´Ù…Ø§ Ø±Ø§ Ø¨ÙØ±Ø³ØªØ¯. Ø¢Ù†â€ŒØ±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø¯Ø± Ø¨Ø§Ù„Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.
                    </p>
                </div>
            </div>

            <div id="verify-step" class="auth-step" style="display: none;">
                <h2>ØªØ§ÛŒÛŒØ¯ Ø­Ø³Ø§Ø¨</h2>
                <p class="auth-description">Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Û¶ Ø±Ù‚Ù…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>

                <form id="verify-form" class="auth-form">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <p style="color: var(--text-secondary); font-size: 14px;">
                            Ú©Ø¯ Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ù‡ Ø²ÛŒØ± Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯:
                        </p>
                        <p style="font-size: 16px; font-weight: 600; color: var(--primary-color);">
                            <span id="verify-user-id"></span>
                        </p>
                    </div>

                    <div class="form-group">
                        <label>Ú©Ø¯ ØªØ§ÛŒÛŒØ¯</label>
                        <input type="text" id="verify-code-input" placeholder="Û¶ Ø±Ù‚Ù…" maxlength="6" required
                            autocomplete="off">
                    </div>

                    <div style="text-align: center; margin-bottom: 16px;">
                        <p style="color: var(--text-secondary); font-size: 13px;">
                            Ú©Ø¯ Ø¨Ø±Ø§ÛŒ <span id="verify-timer">Û³Û°Û°</span> Ø«Ø§Ù†ÛŒÙ‡ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
                        </p>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">ØªØ§ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯</button>
                    <button type="button" class="btn btn-secondary btn-block" style="margin-top: 8px;"
                        id="back-to-login-btn">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
                </form>
            </div>

            <div id="error-message"
                style="display: none; background-color: rgba(239, 68, 68, 0.1); color: var(--danger-color); padding: 12px; border-radius: 8px; margin-top: 16px; text-align: center;">
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-container" id="main-container" style="display: none;">
        <!-- Home Tab -->
        <section id="home-tab" class="tab-content active">
            <div class="container">
                <div class="header">
                    <h1>ğŸ’° Ø·Ù„Ø§ ÛŒØ§Ø±</h1>
                    <button id="theme-toggle" class="theme-btn"><span class="theme-icon">ğŸŒ™</span></button>
                </div>
                <div class="section">
                    <h2 class="section-title">Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ</h2>
                    <div id="prices-container" class="prices-grid">
                        <div class="skeleton-loading"></div>
                        <div class="skeleton-loading"></div>
                    </div>
                </div>
                <div class="section">
                    <h2 class="section-title">Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹</h2>
                    <div class="quick-actions">
                        <button id="add-portfolio-btn" class="btn btn-primary btn-block">â• Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø±Ø§ÛŒÛŒ</button>
                        <button id="add-alert-btn" class="btn btn-secondary btn-block">ğŸ”” ØªÙ†Ø¸ÛŒÙ… Ù‡Ø´Ø¯Ø§Ø±</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Portfolio Tab -->
        <section id="portfolio-tab" class="tab-content">
            <div class="container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="margin: 0;">ğŸ’ Ø¯Ø§Ø±Ø§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ù†</h2>
                    <button id="add-portfolio-btn-2" class="btn btn-primary">â•</button>
                </div>
                <div id="portfolio-list" class="portfolio-list"></div>
                <div id="empty-portfolio" class="empty-state" style="display: none;">
                    <div class="empty-icon">ğŸ“­</div>
                    <p>Ù‡Ù†ÙˆØ² Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</p>
                </div>
            </div>
        </section>

        <!-- Prices Tab -->
        <section id="prices-tab" class="tab-content">
            <div class="container">
                <h2 class="section-title">ğŸ“Š Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø·Ù„Ø§</h2>
                <div id="price-details-18" class="skeleton-loading"></div>
                <div id="price-details-24" class="skeleton-loading"></div>
            </div>
        </section>

        <!-- Alerts Tab -->
        <section id="alerts-tab" class="tab-content">
            <div class="container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="margin: 0;">ğŸ”” Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù‚ÛŒÙ…ØªÛŒ</h2>
                    <button id="add-alert-btn-2" class="btn btn-primary">â•</button>
                </div>
                <div id="alerts-list" class="alerts-list"></div>
                <div id="empty-alerts" class="empty-state" style="display: none;">
                    <div class="empty-icon">ğŸ”•</div>
                    <p>Ù‡Ø´Ø¯Ø§Ø±ÛŒ ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡</p>
                </div>
            </div>
        </section>

        <!-- Profile Tab -->
        <section id="profile-tab" class="tab-content">
            <div class="container">
                <div class="profile-header">
                    <div class="profile-avatar">ğŸ‘¤</div>
                    <div class="profile-info">
                        <h2 id="profile-name">Ú©Ø§Ø±Ø¨Ø±</h2>
                        <p id="profile-username">Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</p>
                    </div>
                </div>
                <div class="section">
                    <h3>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</h3>
                    <div id="profile-details" class="profile-details"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <div id="portfolio-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø¬Ø¯ÛŒØ¯</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="portfolio-form" class="modal-body">
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø·Ù„Ø§</label>
                    <select name="goldType" required>
                        <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                        <option value="24">Ø·Ù„Ø§ÛŒ 24 Ø¹ÛŒØ§Ø±</option>
                        <option value="18">Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ÙˆØ²Ù† (Ú¯Ø±Ù…)</label>
                    <input type="number" name="weight" placeholder="Ù…Ø«Ø§Ù„: 5" step="0.1" required>
                </div>
                <div class="form-group">
                    <label>Ù‚ÛŒÙ…Øª ÙÛŒ (ØªÙˆÙ…Ø§Ù†)</label>
                    <input type="number" name="purchasePrice" placeholder="Ù…Ø«Ø§Ù„: 2500000" required>
                </div>
                <div class="form-group">
                    <label>ØªØ§Ø±ÛŒØ® Ø®Ø±ÛŒØ¯</label>
                    <input type="date" name="purchaseDate" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-block">Ø°Ø®ÛŒØ±Ù‡</button>
                    <button type="button" class="btn btn-secondary btn-block modal-close">Ø§Ù†ØµØ±Ø§Ù</button>
                </div>
            </form>
        </div>
    </div>

    <div id="alert-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªÙ†Ø¸ÛŒÙ… Ù‡Ø´Ø¯Ø§Ø± Ù‚ÛŒÙ…ØªÛŒ</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="alert-form" class="modal-body">
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø·Ù„Ø§</label>
                    <select name="goldType" required>
                        <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                        <option value="24">Ø·Ù„Ø§ÛŒ 24 Ø¹ÛŒØ§Ø±</option>
                        <option value="18">Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ù‡Ø´Ø¯Ø§Ø±</label>
                    <select name="alertType" required>
                        <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                        <option value="above">Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø²</option>
                        <option value="below">Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± Ø§Ø²</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù‚ÛŒÙ…Øª Ù‡Ø¯Ù (ØªÙˆÙ…Ø§Ù†)</label>
                    <input type="number" name="targetPrice" placeholder="Ù…Ø«Ø§Ù„: 2500000" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-block">ØªÙ†Ø¸ÛŒÙ…</button>
                    <button type="button" class="btn btn-secondary btn-block modal-close">Ø§Ù†ØµØ±Ø§Ù</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        document.addEventListener('contextmenu', e => e.preventDefault());

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ”§ Configuration & State
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const CONFIG = {
            API_BASE: 'https://page-teleg.goldyarprice.workers.dev',
            BOT_URL: 'https://t.me/goldyar_investment_bot',
            POLLING_INTERVAL: 60000,
        };

        const tg = window.Telegram?.WebApp;
        let TELEGRAM_INIT_DATA = null;
        let USER_ID = null;
        let TELEGRAM_USER_ID = null;

        let appState = {
            user: null,
            prices: { gold18: 0, gold24: 0 },
            portfolio: [],
            alerts: [],
            isDarkMode: localStorage.getItem('theme') === 'dark',
            isLoggedIn: localStorage.getItem('loginToken') !== null,
            loginToken: localStorage.getItem('loginToken'),
            verificationTimer: null,
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“± Telegram Init
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        if (tg) {
            tg.ready();
            tg.expand();
            TELEGRAM_INIT_DATA = tg.initData || '';
            TELEGRAM_USER_ID = tg.initDataUnsafe?.user?.id;
            console.log('âœ… Telegram Ready - Telegram User ID:', TELEGRAM_USER_ID);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ” Auth Functions
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function requestVerificationCode(userId) {
            try {
                console.log('ğŸ“¤ Requesting verification code for user:', userId);
                const response = await fetch(`${CONFIG.API_BASE}/api/auth/request-code`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: parseInt(userId),
                        telegramUserId: TELEGRAM_USER_ID
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯');
                }

                const data = await response.json();
                console.log('âœ… Verification code requested');
                return true;
            } catch (error) {
                console.error('âŒ Error requesting code:', error);
                showAuthError(error.message);
                return false;
            }
        }

        async function verifyCode(userId, code) {
            try {
                console.log('ğŸ“¤ Verifying code for user:', userId);
                const response = await fetch(`${CONFIG.API_BASE}/api/auth/verify-code`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: parseInt(userId),
                        code: code.toUpperCase(),
                        telegramUserId: TELEGRAM_USER_ID
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Ú©Ø¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                }

                const data = await response.json();
                console.log('âœ… Code verified, token:', data.token);
                return data.token;
            } catch (error) {
                console.error('âŒ Error verifying code:', error);
                showAuthError(error.message);
                return null;
            }
        }

        function saveLoginToken(token) {
            localStorage.setItem('loginToken', token);
            appState.loginToken = token;
            appState.isLoggedIn = true;
        }

        function logout() {
            localStorage.removeItem('loginToken');
            appState.loginToken = null;
            appState.isLoggedIn = false;
            showLoginPage();
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => { errorDiv.style.display = 'none'; }, 5000);
        }

        function showLoginPage() {
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('main-container').style.display = 'none';
            document.getElementById('nav-tabs').style.display = 'none';
            document.getElementById('login-step').style.display = 'block';
            document.getElementById('verify-step').style.display = 'none';
            document.getElementById('get-id-section').style.display = 'none';
            document.getElementById('user-id-hint').style.display = 'block';
        }

        function showMainApp() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('main-container').style.display = 'block';
            document.getElementById('nav-tabs').style.display = 'flex';
            loadInitialData();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ¯ Global Functions
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function formatNumber(num) {
            if (!num) return 'Û°';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",").replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]);
        }

        function formatNumberWithComma(num) {
            if (!num) return '';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function gregorianToJalali(date) {
            if (typeof date === 'string') date = new Date(date + 'T00:00:00');
            const gy = date.getFullYear(), gm = date.getMonth() + 1, gd = date.getDate();
            let g_d_n = 365 * gy + Math.floor((gy + 3) / 4) - Math.floor((gy + 99) / 100) + Math.floor((gy + 399) / 400);
            for (let i = 0; i < gm; i++) g_d_n += new Date(gy, i + 1, 0).getDate();
            let j_d_n = g_d_n - 79, jy = -1600 + 400 * Math.floor(j_d_n / 146097);
            j_d_n %= 146097;
            let flag = true;
            if (j_d_n >= 36525) { j_d_n--; jy += 100 * Math.floor(j_d_n / 36524); j_d_n %= 36524; if (j_d_n >= 365) j_d_n++; flag = false; }
            jy += 4 * Math.floor(j_d_n / 1461); j_d_n %= 1461;
            if (flag) { if (j_d_n >= 366) { j_d_n--; jy += Math.floor(j_d_n / 365); j_d_n = j_d_n % 365; } }
            const sal_a = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
            let jm = 0;
            while (jm < 12 && j_d_n >= sal_a[jm]) jm++;
            if (jm > 1) j_d_n -= sal_a[jm - 1];
            return { year: jy, month: jm, day: j_d_n + 1 };
        }

        function formatJalaliDate(date) {
            if (typeof date === 'string') { const parts = date.split('-'); date = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2])); }
            const jalali = gregorianToJalali(date);
            const months = ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'];
            return `${jalali.day} ${months[jalali.month - 1]} ${jalali.year}`;
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“Š Load Data Functions (GLOBAL SCOPE)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function loadPrices() {
            try {
                console.log('ğŸ“¡ Fetching prices...');
                const response = await fetch(`${CONFIG.API_BASE}/api/gold-prices`, {
                    headers: {
                        'Authorization': `tg ${TELEGRAM_INIT_DATA}`,
                        'User-ID': USER_ID || 'unknown'
                    }
                });
                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                appState.prices = data;
                renderPrices();
                console.log('âœ… Prices loaded');
            } catch (error) {
                console.error('âŒ Price error:', error);
                showToast('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§');
            }
        }

        function renderPrices() {
            const container = document.getElementById('prices-container');
            if (!container) return;
            const html = `
                <div class="price-card">
                    <div class="price-card-title">Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø±</div>
                    <div class="price-card-value">${formatNumber(appState.prices.gold18 || 0)}</div>
                    <div class="price-card-change ${(appState.prices.change18Percent || 0) >= 0 ? 'positive' : 'negative'}">
                        ${(appState.prices.change18Percent || 0) >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${Math.abs(appState.prices.change18Percent || 0).toFixed(2)}%
                    </div>
                </div>
                <div class="price-card">
                    <div class="price-card-title">Ø·Ù„Ø§ÛŒ 24 Ø¹ÛŒØ§Ø±</div>
                    <div class="price-card-value">${formatNumber(appState.prices.gold24 || 0)}</div>
                    <div class="price-card-change ${(appState.prices.change24Percent || 0) >= 0 ? 'positive' : 'negative'}">
                        ${(appState.prices.change24Percent || 0) >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${Math.abs(appState.prices.change24Percent || 0).toFixed(2)}%
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        async function loadPortfolio() {
            try {
                const response = await fetch(`${CONFIG.API_BASE}/api/portfolio`, {
                    headers: { 'Authorization': `tg ${TELEGRAM_INIT_DATA}`, 'User-ID': USER_ID || 'unknown' }
                });
                if (!response.ok) throw new Error('Failed');
                const data = await response.json();
                appState.portfolio = data.items || [];
                renderPortfolio();
            } catch (error) {
                console.error('âŒ Portfolio error:', error);
            }
        }

        function renderPortfolio() {
            const container = document.getElementById('portfolio-list');
            const emptyState = document.getElementById('empty-portfolio');
            if (!container || !emptyState) return;
            if (!appState.portfolio || appState.portfolio.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            container.style.display = 'flex';
            emptyState.style.display = 'none';
            container.innerHTML = appState.portfolio.map(item => `
                <div class="portfolio-item">
                    <div class="portfolio-item-info">
                        <div class="portfolio-item-title">${item.goldType} Ø¹ÛŒØ§Ø±</div>
                        <div class="portfolio-item-details">${item.weight} Ú¯Ø±Ù… â€¢ ${formatJalaliDate(item.purchaseDate)}</div>
                    </div>
                    <div class="portfolio-item-actions">
                        <button class="icon-btn delete" onclick="deletePortfolio(${item.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        async function loadAlerts() {
            try {
                const response = await fetch(`${CONFIG.API_BASE}/api/alerts`, {
                    headers: { 'Authorization': `tg ${TELEGRAM_INIT_DATA}`, 'User-ID': USER_ID || 'unknown' }
                });
                if (!response.ok) throw new Error('Failed');
                const data = await response.json();
                appState.alerts = data.alerts || [];
                renderAlerts();
            } catch (error) {
                console.error('âŒ Alerts error:', error);
            }
        }

        function renderAlerts() {
            const container = document.getElementById('alerts-list');
            const emptyState = document.getElementById('empty-alerts');
            if (!container || !emptyState) return;
            if (!appState.alerts || appState.alerts.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            container.style.display = 'flex';
            emptyState.style.display = 'none';
            container.innerHTML = appState.alerts.map(alert => `
                <div class="alert-item">
                    <div class="alert-item-info">
                        <div class="alert-item-title">${alert.goldType} Ø¹ÛŒØ§Ø±</div>
                        <div class="alert-item-details">${alert.alertType === 'above' ? 'â¬†ï¸' : 'â¬‡ï¸'} ${formatNumber(alert.targetPrice)}</div>
                    </div>
                    <div class="alert-item-actions">
                        <button class="icon-btn delete" onclick="deleteAlert(${alert.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        async function loadProfile() {
            try {
                const response = await fetch(`${CONFIG.API_BASE}/api/profile`, {
                    headers: { 'Authorization': `tg ${TELEGRAM_INIT_DATA}`, 'User-ID': USER_ID || 'unknown' }
                });
                if (!response.ok) throw new Error('Failed');
                const data = await response.json();
                appState.user = { ...appState.user, ...data };
                renderProfile();
            } catch (error) {
                console.error('âŒ Profile error:', error);
            }
        }

        function renderProfile() {
            const nameEl = document.getElementById('profile-name');
            const usernameEl = document.getElementById('profile-username');
            if (!nameEl || !usernameEl) return;
            const firstName = appState.user?.first_name || 'Ú©Ø§Ø±Ø¨Ø±';
            const username = appState.user?.username ? `@${appState.user.username}` : 'Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ';
            nameEl.textContent = firstName;
            usernameEl.textContent = username;
            const userId = appState.user?.user_id || appState.user?.id || USER_ID || 'Ù†Ø§Ù…Ø´Ø®Øµ';
            const profileDetails = document.getElementById('profile-details');
            if (profileDetails) {
                profileDetails.innerHTML = `
                    <div class="profile-detail-item">
                        <span>ğŸ†” Ø´Ù†Ø§Ø³Ù‡</span>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <strong>${userId}</strong>
                            <button onclick="copyToClipboard('${userId}')" style="background: none; border: none; cursor: pointer; font-size: 14px; padding: 4px; color: var(--primary-color);">ğŸ“‹</button>
                        </div>
                    </div>
                    <div class="profile-detail-item"><span>ğŸ“± Ù†Ø§Ù…</span><strong>${firstName}</strong></div>
                    <div class="profile-detail-item"><span>ğŸ‘¤ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</span><strong>${username}</strong></div>
                `;
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('âœ… Ú©Ù¾ÛŒ Ø´Ø¯');
            }).catch(() => {
                showToast('âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ');
            });
        }

        async function loadInitialData() {
            console.log('ğŸ”„ Loading all data...');
            if (!USER_ID) { console.error('âŒ NO USER ID'); return; }
            try {
                await Promise.all([loadPrices(), loadPortfolio(), loadAlerts(), loadProfile()]);
                console.log('âœ… Data loaded');
            } catch (error) {
                console.error('âŒ Error:', error);
            }
        }

        async function deletePortfolio(id) {
            if (!confirm('Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')) return;
            try {
                const response = await fetch(`${CONFIG.API_BASE}/api/portfolio/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `tg ${TELEGRAM_INIT_DATA}`, 'User-ID': USER_ID || 'unknown' }
                });
                if (response.ok) { showToast('âœ… Ø­Ø°Ù Ø´Ø¯'); await loadPortfolio(); }
            } catch (error) { showToast('âŒ Ø®Ø·Ø§'); }
        }

        async function deleteAlert(id) {
            if (!confirm('Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')) return;
            try {
                const response = await fetch(`${CONFIG.API_BASE}/api/alerts/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `tg ${TELEGRAM_INIT_DATA}`, 'User-ID': USER_ID || 'unknown' }
                });
                if (response.ok) { showToast('âœ… Ø­Ø°Ù Ø´Ø¯'); await loadAlerts(); }
            } catch (error) { showToast('âŒ Ø®Ø·Ø§'); }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ›ï¸ Event Listeners & UI
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        document.addEventListener('DOMContentLoaded', () => {
            console.log('âœ… DOM Ready');

            // Ø§Ú¯Ø± logged in Ù†ÛÛŒÚº ÛÛ’ ØªÙˆ login page Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
            if (!appState.isLoggedIn) {
                showLoginPage();
                setupAuthListeners();
                return;
            }

            // Ø§Ú¯Ø± logged in ÛÛ’ ØªÙˆ main app Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
            USER_ID = localStorage.getItem('userId');
            showMainApp();
            setupAppListeners();
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ” Auth Event Listeners
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function setupAuthListeners() {
            // Login form
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const userId = document.getElementById('user-id-input').value.trim();
                if (!userId) {
                    showAuthError('Ù„Ø·ÙØ§ Ø´Ù†Ø§Ø³Ù‡ Ø¹Ø¯Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                    return;
                }

                const success = await requestVerificationCode(userId);
                if (success) {
                    USER_ID = userId;
                    document.getElementById('verify-user-id').textContent = userId;
                    document.getElementById('login-step').style.display = 'none';
                    document.getElementById('verify-step').style.display = 'block';
                    startVerificationTimer();
                }
            });

            // Get ID button
            document.getElementById('show-get-id-btn').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('get-id-section').style.display =
                    document.getElementById('get-id-section').style.display === 'none' ? 'block' : 'none';
            });

            // Open bot button
            document.getElementById('open-bot-btn').addEventListener('click', () => {
                window.open(CONFIG.BOT_URL, '_blank');
            });

            // Verify form
            document.getElementById('verify-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const code = document.getElementById('verify-code-input').value.trim();
                if (code.length !== 6) {
                    showAuthError('Ú©Ø¯ Ø¨Ø§ÛŒØ¯ Û¶ Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯');
                    return;
                }

                const token = await verifyCode(USER_ID, code);
                if (token) {
                    saveLoginToken(token);
                    localStorage.setItem('userId', USER_ID);
                    showToast('âœ… Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!');
                    setTimeout(() => {
                        appState.isLoggedIn = true;
                        showMainApp();
                        setupAppListeners();
                    }, 500);
                }
            });

            // Back button
            document.getElementById('back-to-login-btn').addEventListener('click', () => {
                clearInterval(appState.verificationTimer);
                document.getElementById('login-step').style.display = 'block';
                document.getElementById('verify-step').style.display = 'none';
                document.getElementById('verify-code-input').value = '';
                document.getElementById('error-message').style.display = 'none';
            });
        }

        function startVerificationTimer() {
            let timeLeft = 300; // 5 minutes
            const timerElement = document.getElementById('verify-timer');

            appState.verificationTimer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(appState.verificationTimer);
                    showAuthError('Ú©Ø¯ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø³Ø¹ÛŒ Ú©Ù†ÛŒØ¯');
                    document.getElementById('verify-step').style.display = 'none';
                    document.getElementById('login-step').style.display = 'block';
                }
            }, 1000);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ›ï¸ App Event Listeners
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function setupAppListeners() {
            // Tab switching
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabName = btn.dataset.tab;
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(`${tabName}-tab`).classList.add('active');
                    if (tabName === 'portfolio') loadPortfolio();
                    else if (tabName === 'prices') loadPrices();
                    else if (tabName === 'alerts') loadAlerts();
                    else if (tabName === 'profile') loadProfile();
                });
            });

            // Apply dark mode if saved
            if (appState.isDarkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('theme-toggle').querySelector('.theme-icon').textContent = 'â˜€ï¸';
            }

            // Theme toggle
            document.getElementById('theme-toggle').addEventListener('click', () => {
                appState.isDarkMode = !appState.isDarkMode;
                document.documentElement.setAttribute('data-theme', appState.isDarkMode ? 'dark' : 'light');
                document.getElementById('theme-toggle').querySelector('.theme-icon').textContent = appState.isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
                localStorage.setItem('theme', appState.isDarkMode ? 'dark' : 'light');
            });

            // Modal buttons
            document.getElementById('add-portfolio-btn').addEventListener('click', () => {
                document.getElementById('portfolio-modal').classList.add('active');
                document.querySelector('input[name="purchaseDate"]').valueAsDate = new Date();
            });

            document.getElementById('add-portfolio-btn-2').addEventListener('click', () => {
                document.getElementById('portfolio-modal').classList.add('active');
                document.querySelector('input[name="purchaseDate"]').valueAsDate = new Date();
            });

            document.getElementById('add-alert-btn').addEventListener('click', () => {
                document.getElementById('alert-modal').classList.add('active');
            });

            document.getElementById('add-alert-btn-2').addEventListener('click', () => {
                document.getElementById('alert-modal').classList.add('active');
            });

            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
                });
            });

            // Price input formatting
            const setupPriceInput = (inputName) => {
                const input = document.querySelector(`input[name="${inputName}"]`);
                if (input) {
                    input.addEventListener('input', function () {
                        let value = this.value.replace(/,/g, '');
                        this.value = formatNumberWithComma(value);
                    });
                }
            };

            // Re-setup when modals open
            const observer = new MutationObserver(() => {
                setupPriceInput('purchasePrice');
                setupPriceInput('targetPrice');
            });
            observer.observe(document.body, { childList: true, subtree: true, attributes: true, attributeFilter: ['class'] });

            // Form submissions
            document.getElementById('portfolio-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const payload = {
                    goldType: formData.get('goldType'),
                    weight: parseFloat(formData.get('weight')),
                    purchasePrice: parseInt(formData.get('purchasePrice').replace(/,/g, '')),
                    purchaseDate: formData.get('purchaseDate'),
                };
                try {
                    const response = await fetch(`${CONFIG.API_BASE}/api/portfolio/add`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `tg ${TELEGRAM_INIT_DATA}`,
                            'Content-Type': 'application/json',
                            'User-ID': USER_ID || 'unknown'
                        },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) {
                        showToast('âœ… Ø¯Ø§Ø±Ø§ÛŒÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
                        document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
                        e.target.reset();
                        await loadPortfolio();
                    }
                } catch (error) { showToast('âŒ Ø®Ø·Ø§'); }
            });

            document.getElementById('alert-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                const payload = {
                    goldType: formData.get('goldType'),
                    alertType: formData.get('alertType'),
                    targetPrice: parseInt(formData.get('targetPrice').replace(/,/g, ''))
                };
                try {
                    const response = await fetch(`${CONFIG.API_BASE}/api/alerts/add`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `tg ${TELEGRAM_INIT_DATA}`,
                            'Content-Type': 'application/json',
                            'User-ID': USER_ID || 'unknown'
                        },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) {
                        showToast('âœ… Ù‡Ø´Ø¯Ø§Ø± ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯');
                        document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
                        e.target.reset();
                        await loadAlerts();
                    }
                } catch (error) { showToast('âŒ Ø®Ø·Ø§'); }
            });

            // Load initial data
            setTimeout(() => {
                loadInitialData();
                setInterval(() => loadPrices(), CONFIG.POLLING_INTERVAL);
            }, 500);
        }
    </script>
</body>

</html>
